# Koda 项目开发任务清单

> 本文档记录 Koda 项目的开发任务及完成状态

## 📅 项目信息

- **项目名称**: Koda
- **项目目标**: 自动化生成学术组会 Beamer PPT
- **当前阶段**: Phase 4 - 代码实现
- **最后更新**: 2024-12-30

---

## ✅ 已完成任务

### 核心功能模块

- [x] **arXiv源码下载模块** (`core/fetcher.py`)
  - [x] 实现arXiv搜索和下载
  - [x] 支持tar.gz和zip格式自动解压
  - [x] 错误处理

- [x] **LaTeX解析模块** (`core/parser.py`)
  - [x] 去除LaTeX注释
  - [x] 扁平化文件树（处理\input, \include等）
  - [x] 提取frame块

- [x] **LLM生成模块** (`core/generator.py`)
  - [x] OpenAI集成（已修复API调用错误）
  - [x] Anthropic集成
  - [x] Prompt构建
  - [x] 单页修复功能
  - [x] 日志记录

- [x] **LaTeX编译模块** (`core/compiler.py`)
  - [x] latexmk支持
  - [x] pdflatex支持
  - [x] 模板与正文合并

- [x] **PDF渲染模块** (`utils/pdf_renderer.py`)
  - [x] PyMuPDF集成
  - [x] DPI可配置

### UI界面

- [x] **Streamlit主界面** (`app.py`)
  - [x] 侧边栏参数输入
  - [x] 左右双栏布局
  - [x] PDF预览显示
  - [x] 单页修复交互
  - [x] 进度日志显示

### 配置与文档

- [x] **配置文件** (`config.yaml`)
  - [x] 应用配置
  - [x] LLM配置
  - [x] LaTeX编译器配置
  - [x] PDF渲染配置

- [x] **核心Prompt模板** (`assets/AGENTS.md`)
  - [x] 完整的生成规则
  - [x] 格式约束定义
  - [x] 内容结构要求

- [x] **依赖管理** (`requirements.txt`)
  - [x] 所有必需包列出

- [x] **示例模板** (`assets/templates/example_template.tex`)
  - [x] 基础Beamer模板

- [x] **部署文档** (`docs/deployment.md`)
  - [x] 环境要求说明
  - [x] 安装步骤
  - [x] 配置指南
  - [x] 常见问题解答

- [x] **使用指南** (`docs/user_guide.md`)
  - [x] 快速开始
  - [x] 基本流程
  - [x] 实战示例
  - [x] 最佳实践
  - [x] 进阶技巧

### Bug修复

- [x] **修复OpenAI API调用错误**
  - 问题：使用了不存在的 `client.responses.create` 方法
  - 修复：改为正确的 `client.chat.completions.create`
  - 影响文件：`core/generator.py`

---

## 🚧 待开发任务

### 功能增强

- [ ] **重试机制**
  - [ ] 为LLM调用添加tenacity重试装饰器
  - [ ] 为arXiv下载添加重试机制
  - [ ] 为LaTeX编译添加错误恢复

- [ ] **日志系统**
  - [ ] 添加结构化日志记录
  - [ ] 支持不同日志级别
  - [ ] 日志文件轮转

- [ ] **进度指示**
  - [ ] 添加进度条显示
  - [ ] 实时更新各阶段状态

- [ ] **批量处理**
  - [ ] 支持多篇论文批量生成
  - [ ] 导出批处理结果

### UI改进

- [ ] **交互优化**
  - [ ] 添加"保存配置"功能
  - [ ] 支持历史记录查看
  - [ ] 支持模板管理界面

- [ ] **预览增强**
  - [ ] 支持页面跳转
  - [ ] 支持缩放控制
  - [ ] 支持全屏预览

### 错误处理

- [ ] **输入验证**
  - [ ] arXiv ID格式验证
  - [ ] 模板路径存在性检查
  - [ ] API密钥格式验证

- [ ] **友好错误提示**
  - [ ] 网络错误提示
  - [ ] 编译错误详细提示
  - [ ] API配额提示

### 性能优化

- [ ] **缓存机制**
  - [ ] 论文源码缓存（避免重复下载）
  - [ ] LLM输出缓存
  - [ ] 编译产物缓存

- [ ] **并发处理**
  - [ ] 异步下载
  - [ ] 并行编译

### 测试

- [ ] **单元测试**
  - [ ] core模块测试
  - [ ] utils模块测试
  - [ ] 集成测试

- [ ] **端到端测试**
  - [ ] 完整流程测试
  - [ ] 边界情况测试

---

## 💡 未来规划

### 短期目标（v1.1）

- [ ] 添加完整的错误处理和重试机制
- [ ] 优化UI交互体验
- [ ] 完善日志系统
- [ ] 编写单元测试

### 中期目标（v1.5）

- [ ] 支持本地LLM（如Ollama）
- [ ] 支持PDF直接解析（无LaTeX源码）
- [ ] 支持更多Beamer主题
- [ ] 添加PPT导出（PowerPoint格式）

### 长期目标（v2.0）

- [ ] Web服务化（多用户支持）
- [ ] 协作功能（团队共享模板）
- [ ] 智能推荐（根据论文类型推荐模板）
- [ ] 移动端支持

---

## 📝 开发备注

### 技术债

1. `compiler.py` 中的错误处理较简单，应该捕获更详细的编译错误信息
2. `parser.py` 的文件扁平化逻辑可能无法处理复杂的LaTeX项目结构
3. 缺少对LLM上下文长度的动态调整（超长论文可能失败）

### 已知限制

1. 不支持没有LaTeX源码的纯PDF论文
2. 对特殊LaTeX宏包的支持有限
3. LLM生成质量依赖于模型能力和Prompt质量
4. 编译需要完整的LaTeX环境（约3-5GB）

### 优化建议

1. 考虑使用流式输出减少等待时间
2. 添加模板预览功能
3. 支持自定义占位图路径
4. 添加"一键分享"功能（导出到云端）

---

## 🔄 版本历史

### v1.0.0 (2024-12-30)
- ✅ 核心功能实现
- ✅ 基础UI完成
- ✅ 文档完善
- ✅ 修复OpenAI API调用Bug

---

**开发者**: LIN  
**最后更新**: 2024-12-30 19:12
